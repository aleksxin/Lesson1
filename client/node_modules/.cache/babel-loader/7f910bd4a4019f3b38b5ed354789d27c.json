{"ast":null,"code":"import { signInWithEmailAndPassword, signInWithPopup } from \"firebase/auth\";\nimport { getDoc } from \"firebase/firestore\";\nimport { all, call, put, takeLatest } from \"redux-saga/effects\";\nimport { auth, createUserProfileDocument, getCurrentUser, gooogleProvider } from \"../../firebase/firebase.utils\";\nimport { emailSignInStart, signInFailure, signOutFailure, signOutSuccess, signSuccess, signUpFail, signUpSuccessLogin } from \"./user.actions\";\nimport UserActionTypes from \"./user.types\";\nexport function* getSnapshotFromUserAuth(userAuth, additionalData) {\n  try {\n    const userRef = yield call(createUserProfileDocument, userAuth, additionalData);\n    const userSnapshot = yield getDoc(userRef);\n    yield put(signSuccess({\n      id: userSnapshot.id,\n      ...userSnapshot.data()\n    })); // console.log(userRef);\n  } catch (error) {\n    yield put(signInFailure(error));\n  }\n}\nexport function* signInWithGoogle() {\n  try {\n    const {\n      user\n    } = yield signInWithPopup(auth, gooogleProvider);\n    yield getSnapshotFromUserAuth(user); // console.log(userRef);\n  } catch (error) {\n    yield put(signInFailure(error));\n  }\n}\nexport function* signInWithEmail(_ref) {\n  let {\n    payload: {\n      email,\n      password\n    }\n  } = _ref;\n\n  try {\n    const {\n      user\n    } = yield signInWithEmailAndPassword(auth, email, password);\n    yield getSnapshotFromUserAuth(user);\n  } catch (error) {\n    yield put(signInFailure(error));\n  }\n}\nexport function* isUserAuthenticated() {\n  try {\n    const userAuth = yield getCurrentUser();\n    if (!userAuth) return;\n    yield getSnapshotFromUserAuth(userAuth);\n  } catch (error) {\n    yield put(signInFailure(error));\n  }\n}\nexport function* singOut() {\n  try {\n    yield auth.signOut();\n    yield put(signOutSuccess());\n  } catch (error) {\n    yield put(signOutFailure(error));\n  }\n}\nexport function* signUpWithEmailAndPasswor(_ref2) {\n  let {\n    payload: {\n      email,\n      password,\n      displayName\n    }\n  } = _ref2;\n\n  try {\n    const {\n      user\n    } = yield createUserWithEmailAndPassword(auth, email, password); //const {user} = await auth.createUserWithEmailAndPassword(email,password);\n\n    yield put(signUpSuccessLogin({\n      user,\n      additionalData: {\n        displayName\n      }\n    }));\n    yield createUserProfileDocument(user, {\n      displayName\n    });\n  } catch (error) {\n    yield put(signUpFail(error));\n  }\n}\nexport function* signInAfterSignUp(_ref3) {\n  let {\n    payload: {\n      user,\n      additionalData\n    }\n  } = _ref3;\n  // try{\n  yield getSnapshotFromUserAuth(user, additionalData); // put(emailSignInStart());\n  // }catch (error) {\n  // yield put(signInFailure(error));\n  // }\n}\nexport function* onGoogleSignInStart() {\n  yield takeLatest(UserActionTypes.GOOGLE_SIGN_IN_START, signInWithGoogle);\n}\nexport function* onEmailSignInStart() {\n  yield takeLatest(UserActionTypes.EMAIL_SIGN_IN_START, signInWithEmail);\n}\nexport function* onCheckUserSession() {\n  yield takeLatest(UserActionTypes.CHECK_USER_SESSION, isUserAuthenticated);\n}\nexport function* onSignOutStart() {\n  yield takeLatest(UserActionTypes.SIGN_OUT_START, singOut);\n}\nexport function* onSignUpInit() {\n  yield takeLatest(UserActionTypes.SIGN_UP_INITIALIZE, signUpWithEmailAndPasswor);\n}\nexport function* onSignUpSucess() {\n  yield takeLatest(UserActionTypes.SIGN_UP_SUCCESS, signInAfterSignUp);\n}\nexport function* userSagas() {\n  yield all([call(onGoogleSignInStart), call(onEmailSignInStart), call(onCheckUserSession), call(onSignOutStart), call(onSignUpInit), call(onSignUpSucess)]);\n}","map":{"version":3,"sources":["/home/sasho/reactpr/clothing-shit/src/redux/user/user.sagas.js"],"names":["signInWithEmailAndPassword","signInWithPopup","getDoc","all","call","put","takeLatest","auth","createUserProfileDocument","getCurrentUser","gooogleProvider","emailSignInStart","signInFailure","signOutFailure","signOutSuccess","signSuccess","signUpFail","signUpSuccessLogin","UserActionTypes","getSnapshotFromUserAuth","userAuth","additionalData","userRef","userSnapshot","id","data","error","signInWithGoogle","user","signInWithEmail","payload","email","password","isUserAuthenticated","singOut","signOut","signUpWithEmailAndPasswor","displayName","createUserWithEmailAndPassword","signInAfterSignUp","onGoogleSignInStart","GOOGLE_SIGN_IN_START","onEmailSignInStart","EMAIL_SIGN_IN_START","onCheckUserSession","CHECK_USER_SESSION","onSignOutStart","SIGN_OUT_START","onSignUpInit","SIGN_UP_INITIALIZE","onSignUpSucess","SIGN_UP_SUCCESS","userSagas"],"mappings":"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","sourcesContent":["import { signInWithEmailAndPassword, signInWithPopup } from \"firebase/auth\";\nimport { getDoc } from \"firebase/firestore\";\n\nimport { all, call, put, takeLatest } from \"redux-saga/effects\";\nimport { auth, createUserProfileDocument, getCurrentUser, gooogleProvider } from \"../../firebase/firebase.utils\";\nimport { emailSignInStart, signInFailure, signOutFailure, signOutSuccess, signSuccess, signUpFail, signUpSuccessLogin } from \"./user.actions\";\nimport UserActionTypes from \"./user.types\";\n\nexport function* getSnapshotFromUserAuth(userAuth, additionalData) {\n    try {\n        const userRef = yield call(createUserProfileDocument, userAuth, additionalData);\n        const userSnapshot = yield getDoc(userRef);\n        yield put(signSuccess({ id: userSnapshot.id, ...userSnapshot.data() }));\n        // console.log(userRef);\n    } catch (error) {\n        yield put(signInFailure(error));\n    }\n}\n\nexport function* signInWithGoogle() {\n    try {\n        const { user } = yield signInWithPopup(auth, gooogleProvider);\n        yield getSnapshotFromUserAuth(user);\n\n        // console.log(userRef);\n    } catch (error) {\n        yield put(signInFailure(error));\n    }\n}\n\nexport function* signInWithEmail({ payload: { email, password } }) {\n    try {\n        const { user } = yield signInWithEmailAndPassword(auth, email, password);\n        yield getSnapshotFromUserAuth(user);\n\n    } catch (error) {\n        yield put(signInFailure(error));\n    }\n}\n\nexport function* isUserAuthenticated() {\n    try {\n        const userAuth = yield getCurrentUser();\n        if (!userAuth) return;\n        yield getSnapshotFromUserAuth(userAuth);\n\n    } catch (error) {\n        yield put(signInFailure(error));\n    }\n}\n\nexport function* singOut() {\n    try {\n        yield auth.signOut();\n        yield put(signOutSuccess());\n    } catch (error) {\n        yield put(signOutFailure(error));\n    }\n}\n\nexport function* signUpWithEmailAndPasswor({ payload: { email, password, displayName } }) {\n    try {\n        const { user } = yield createUserWithEmailAndPassword(auth, email, password);\n        //const {user} = await auth.createUserWithEmailAndPassword(email,password);\n        yield put(signUpSuccessLogin({ user, additionalData: { displayName } }));\n        yield createUserProfileDocument(user, { displayName });\n    } catch (error) {\n        yield put(signUpFail(error));\n    }\n\n\n}\n\nexport function* signInAfterSignUp({ payload: { user, additionalData } }) {\n    // try{\n    yield getSnapshotFromUserAuth(user, additionalData);\n    // put(emailSignInStart());\n    // }catch (error) {\n    // yield put(signInFailure(error));\n    // }\n}\n\nexport function* onGoogleSignInStart() {\n    yield takeLatest(UserActionTypes.GOOGLE_SIGN_IN_START, signInWithGoogle);\n}\n\nexport function* onEmailSignInStart() {\n    yield takeLatest(UserActionTypes.EMAIL_SIGN_IN_START, signInWithEmail);\n}\n\nexport function* onCheckUserSession() {\n    yield takeLatest(UserActionTypes.CHECK_USER_SESSION, isUserAuthenticated);\n}\n\nexport function* onSignOutStart() {\n    yield takeLatest(UserActionTypes.SIGN_OUT_START, singOut);\n}\n\nexport function* onSignUpInit() {\n    yield takeLatest(UserActionTypes.SIGN_UP_INITIALIZE, signUpWithEmailAndPasswor);\n}\n\nexport function* onSignUpSucess() {\n    yield takeLatest(UserActionTypes.SIGN_UP_SUCCESS, signInAfterSignUp);\n}\n\nexport function* userSagas() {\n    yield all([call(onGoogleSignInStart), call(onEmailSignInStart), call(onCheckUserSession), call(onSignOutStart), call(onSignUpInit), call(onSignUpSucess)]);\n\n}\n\n"]},"metadata":{},"sourceType":"module"}